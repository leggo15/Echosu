{% extends 'base.html' %}
{% load static %}

{% block title %}Settings{% endblock %}
{% block head_css %}
  <link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}
{% block foot_js %}
  <script>
    window.settingsPage = {
      csrf: '{{ csrf_token }}',
      settingsUrl: '{% url 'settings' %}',
      confirmUrl: '{% url 'confirm_data_deletion' %}'
    };
  </script>
  <script src="{% static 'js/settings.js' %}"></script>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="settings-page">
            <h1>Settings
              <button type="submit" form="settingsPreferencesForm" class="generic_btn" style="margin-left:12px; vertical-align:middle;">Save</button>
            </h1>

            <!-- Display messages -->
            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if full_key %}
                <div class="api-key-notice">
                    <p><strong>New API Key:</strong> <span class="api-key">{{ full_key }}</span></p>
                    <p class="important-note">Make sure to copy your API key now. You won't be able to see it again.</p>
                </div>
            {% endif %}

            <!-- API Keys Section -->
            <div class="api-keys-section">
                <!-- Collapsible Header -->
                <button class="collapsible-header" aria-expanded="false" aria-controls="api-keys-content">
                    API
                    <span class="arrow">&#9660;</span> <!-- Down arrow -->
                </button>

                <!-- Collapsible Content -->
                <div class="collapsible-content" id="api-keys-content" aria-hidden="true">
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" name="generate_token" class="generic_btn">Generate API Token</button>
                    </form>
                    <a href="https://github.com/leggo15/echosu_API_Documentation" class="beatmap-link">API documentation</a>


                </div>
            </div>

            <!-- Tag Display Preferences -->
            <div class="preferences-section">
              <h2>Tag Display</h2>
              <form method="post" action="{% url 'settings' %}" class="settings-form" id="settingsPreferencesForm">
                {% csrf_token %}
                <input type="hidden" name="update_preferences" value="1">
                <label for="tag_category_display">Tag categories:</label>
                <select id="tag_category_display" name="tag_category_display">
                  {% with pref=tag_category_display|default:'color' %}
                    <option value="none" {% if pref == 'none' %}selected{% endif %}>Do not display</option>
                    <option value="color" {% if pref == 'color' %}selected{% endif %}>Color coding</option>
                    <option value="lists" {% if pref == 'lists' %}selected{% endif %}>Separate lists per card</option>
                  {% endwith %}
                </select>
                <button type="submit" class="generic_btn" style="margin-left:8px;">Save</button>
              </form>
            </div>

            <!-- Data Deletion Section -->
            <div class="data-deletion-section">
                <h2>Delete All Your Data</h2>
                <p>If you wish to delete all your contributions and data from our site, you can do so by clicking the button below. This action is irreversible.</p>
                <button type="button" class="delete-data-btn">Delete All My Data</button>
            </div>

        </div>
    </div>
{% endblock %}
