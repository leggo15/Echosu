{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Edit Tags</title>
        <link rel="stylesheet" href="https://echosu-s3.s3.eu-central-1.amazonaws.com/static/css/master.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://echosu-s3.s3.eu-central-1.amazonaws.com/static/js/master.js"></script>
        <meta name="csrf-token" content="{{ csrf_token }}">

    </head>
    <body>
        {% include '_navbar.html' %}
        <div class="container">
            {% load static %}
            {% load custom_tags %}
            {% block content %}
            <h1>Edit Tags</h1>
            
            <!-- Display Django Messages -->
            {% if messages %}
                {% for message in messages %}
                    <p class="message {{ message.tags }}">{{ message }}</p>
                {% endfor %}
            {% endif %}
            
            <!-- Search Form -->
            <form method="get" action="{% url 'edit_tags' %}" class="tag-search-form">
                <input type="text" name="search" placeholder="Search tags..." value="{{ search_query }}">
                <button type="submit" class="generic_btn">Search</button>
            </form>
            
            <!-- Tags Table -->
            <table>
                <thead>
                    <tr>
                        <th>Tag Name</th>
                        <th>Description</th>
                        <th>Edited By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tag in tags %}
                    <tr>
                        <td>{{ tag.name }}</td>
                        <td>
                            <textarea class="tag-description" data-tag-id="{{ tag.id }}" rows="2" cols="50" {% if tag.is_locked %}disabled{% endif %}>{{ tag.description }}</textarea>
                            {% if not tag.is_locked %}
                            <div class="vote-section" data-tag-id="{{ tag.id }}">
                                <span class="vote-count upvote-count">{{ tag.upvotes }}</span>
                                <button class="upvote-btn generic_btn {% if tag.is_locked %}disabled-btn{% endif %}"
                                        {% if tag.is_locked or user_votes|get_item:tag.id %}
                                        disabled
                                        {% endif %}
                                        {% if user_votes|get_item:tag.id == 'upvote' %}
                                        style="background-color: green;"
                                        {% endif %}>
                                    Upvote
                                </button>
                                <button class="downvote-btn generic_btn {% if tag.is_locked %}disabled-btn{% endif %}"
                                        {% if tag.is_locked or user_votes|get_item:tag.id %}
                                        disabled
                                        {% endif %}
                                        {% if user_votes|get_item:tag.id == 'downvote' %}
                                        style="background-color: red;"
                                        {% endif %}>
                                    Downvote
                                </button>
                                <span class="vote-count downvote-count">{{ tag.downvotes }}</span>
                            </div>
                            {% else %}
                                <p> Vote is locked. </p>
                            {% endif %}
                        </td>
                        <td>
                            {% if tag.description_author %}
                                {{ tag.description_author.username }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Pagination Controls -->
            <div class="pagination">
                <span class="step-links">
                    {% if tags.has_previous %}
                        <a href="?search={{ search_query }}&page=1">&laquo; first</a>
                        <a href="?search={{ search_query }}&page={{ tags.previous_page_number }}">previous</a>
                    {% endif %}
    
                    <span class="current">
                        Page {{ tags.number }} of {{ tags.paginator.num_pages }}.
                    </span>
    
                    {% if tags.has_next %}
                        <a href="?search={{ search_query }}&page={{ tags.next_page_number }}">next</a>
                        <a href="?search={{ search_query }}&page={{ tags.paginator.num_pages }}">last &raquo;</a>
                    {% endif %}
                </span>
            </div>
            
            <!-- Message Area for AJAX Feedback -->
            <div id="message-area"></div>
            
            <!-- Loading Spinner -->
            <div id="loading-spinner">
                <img src="{% static 'images/spinner.gif' %}" alt="Loading...">
            </div>
            
            {% endblock %}
        </div>
    </body>
</html>
